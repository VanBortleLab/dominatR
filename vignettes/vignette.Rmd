---
title: "Introduction to dominatR"
author: "Simon Lizarazo, Ethan Chen, Rajendra KC, Kevin Van Bortle"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Introduction to dominatR}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
        collapse = TRUE,
        comment = "#>", 
        fig.align = 'center',
        warning = FALSE, 
        message = FALSE
)

library(dominatR)
library(dominatRData)
library(airway)
library(ggplot2)

```

# Overview

<img src="../man/figures/dominatR_logo.png" align="left" width="132"/>

The `dominatR` package provides a flexible suite for feature dominance
visualization, it uses Shanon's entropy as method for assigning feature
dominance. The broad idea of dominance visualization relies on the
spatial localization of observations at the extremes.

Moreover the package offers tools for normalization and it is compatible
with common data structures like `matrix`, `data.frame`, and
`SummarizedExperiment`.

The functions present in the package can be grouped as:

-   **Normalization Functions:** Contains basic normalization methods,
    such as:

    -   `cpm_normalization`

    -   `minmax_normalization`

    -   `quantile_normalization`

    -   `rpkm_normalization`

    -   `tpm_normalization`

-   **Calculation Functions:** Contains feature calculation methods,
    such as:

    -   `centmass`

    -   `entropy`

    -   `Qentropy`

-   **Visualization Functions:** Contains three different visualization
    tools, ideal for assessing dominance in 2, 3 and N Dimension:

    -   `plot_rope`

    -   `plot_triangle`

    -   `plot_circle`

This vignettes serves a quick tutorial for using `dominatR`. Further
manipulation and features present in the package can be explored the
additional articles.

## Data

For understanding the features available in this package, the datasets
available in `dominatRData` are usefull along with the `airway` dataset.

## - Normalization - Quantile Normalization

### A SummarizedExperiment

```{r se_norm, eval = TRUE, echo = TRUE, message = FALSE}
data("airway")

se = quantile_normalization(airway, new_assay_name = 'quantile_norma')

head(se)
head(assay(se, 'quantile_norma'))
```

### A dataframe

```{r df_norm, eval = TRUE, echo = TRUE, message = FALSE}
data("atac_tissue_counts")

## selecting the numeric columns
norm = atac_tissue_counts[,8:26]

norm1 = quantile_normalization(norm)

head(norm1[,1:10])
```

## - Calculations - Entropy

### A Summarized Experiment

```{r se_entr, eval = TRUE, echo = TRUE, message = FALSE}

se = entropy(se)

head(se)

### It creates a new column in the rowData dataframe
head(rowData(se))
```

### A Data Frame

```{r df_entr, eval = TRUE, echo = TRUE, message = FALSE}

norm1 = entropy(norm)

### It creates a new column in the dataframe
head(norm1[,10:20])
```

## - Visualizations

All the functions present in the package are able to handle
`SummarizedExperiment` and `data.frame` objects. This quick introduction
will show examples using `data.frame` objects. All the functions produce
graphic and a data.frame with the dominance results, by setting the
atribute `output_table = FALSE` the dataframe is not displayed. For a
more detailed usage and aesthetics manipulation refer to the articles in
the visualization section.

### Two Dimensions

`plot_rope` is useful to visualize feature dominance between two
variables. In this example the function is comparing dominance over gene
occupancy for RNA Polymerase II and RNA Polymerase III. By default the
function plots all the points, but the user can adjust `entropy_range`
values for subsetting specific type of observations.

```{r rope_pol3, eval = TRUE, echo = TRUE, message = FALSE}
data("rnapol_score")

data1 <- rnapol_score[,6:7]

plot_rope(
        data1, 
        rope_color = 'white',
        pch = c(21, 21), 
        push_text = 1.2,
        col = c('#F8766d', '#C77CFF'),
        output_table = FALSE,
        rope_width = 1
)

title(main = 'Gene Occupancy RNA Pol II vs RNA Pol III',
        font.main = 1, 
        cex = 0.5)
```

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Let's filter genes with low entropy and high scores (significant), these
genes are occupied for either Pol-II and Pol-III

```{r rope_pol3_filt, eval = TRUE, echo = TRUE, message = FALSE}

plot_rope(
        data1, 
        rope_color = 'white',
        pch = c(21, 21), 
        col = c('#F8766d', '#C77CFF'),
        push_text = 1.2,
        output_table = FALSE,
        rope_width = 1,
        entropyrange = c(0, 0.5),
        maxvaluerange = c(1.3, Inf)
)


title(main = 'Gene Occupancy \n RNA Pol II vs RNA Pol III - Specific',
        font.main = 1, 
        cex = 0.5)
```

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Let's filter genes with high entropy and high scores (significant),
these genes are occupied for both Pol-II and Pol-III

```{r rope_pol3_filt1, eval = TRUE, echo = TRUE, message = FALSE}

plot_rope(
        data1,
        pch = c(21,21), 
        push_text = 1.2,
        rope_color = 'white',
        col = c('#F8766d', '#C77CFF'),
        output_table = FALSE,
        rope_width = 1,
        entropyrange = c(0.8, 1),
        maxvaluerange = c(1.3, Inf)
)

title(main = 'Gene Occupancy \n RNA Pol II vs RNA Pol III - Shared',
        font.main = 1, 
        cex = 0.5)

```

### Three Dimensions

`plot_triange` is useful to visualize feature dominance between three
variables. In this example, the function is comparing dominance over
gene occupancy for RNA Polymerase I, RNA Polymerase II and RNA
Polymerase III. By default the function plots all the points, but the
user can adjust `entropy_range` values for subsetting specific type of
observations.

```{r trin_pol3, eval = TRUE, echo = TRUE, message = FALSE}
data1 <- rnapol_score[,5:7]

plot_triangle(data1,
                output_table = FALSE,
                col = c('#F8766d', '#C77CFF', '#00BFC4'),
                label = TRUE, pch = 21, 
                push_text = 1.3)

title(main = 'Gene Occupancy \n Pol I vs Pol II vs Pol III',
        font.main = 1, 
        cex = 0.5)
```

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Let's filter genes with low entropy and high scores (significant), these
genes are occupied for either Pol-I, Pol-II and Pol-III

```{r trin_pol3_filt, eval = TRUE, echo = TRUE, message = FALSE}
data1 <- rnapol_score[,5:7]

plot_triangle(data1, 
                output_table = FALSE, 
                col = c('#F8766d', '#C77CFF', '#00BFC4'),
                entropyrange = c(0,0.5),
                label = TRUE, pch = 21,
                push_text = 1.3)

title(main = 'Gene Occupancy \n Pol I vs Pol II vs Pol III - Specific',
        font.main = 1, 
        cex = 0.5)

```

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Let's filter genes with high entropy and high scores (significant),
these genes are occupied for the three polymerases, or for a pair of
them (p.e, Pol I and Pol II or Pol II and Pol III).

```{r trin_pol3_filt1, eval = TRUE, echo = TRUE, message = FALSE}
data1 <- rnapol_score[,5:7]

plot_triangle(data1, 
                output_table = FALSE, 
                col = c('#F8766d', '#C77CFF', '#00BFC4'),
                entropyrange = c(1.5, Inf),
                label = TRUE, pch = 21,
                push_text = 1.3)

title(main = 'Gene Occupancy \n Pol I vs Pol II vs Pol III - Shared',
        font.main = 1, 
        cex = 0.5)

```

Therefore as observations start getting closer to the center of the
triangle and moving away from the vertices, those observations display
shared features

### N-Dimensions

`plot_circle` is useful to visualize feature dominance between N-Numbers
of variables. In this example, the function is comparing RNA-Pol III
transcribed genes accessibility across tissues. By default the function
plots all the points, but the user can adjust `entropy_range` values for
subsetting specific type of observations.

Briefly A total of P-1 (P = Number of Variables) circles are plotted and
they represent degrees of dominance.

-   The outtermost circle represents observations that are dominated
    only by one variable.

-   The second outtermost circle represents observations that are
    dominated by two variables.

-   The innermost circle represents observations that are uniform across
    all variables.

```{r circ_tiss, eval = TRUE, echo = TRUE, message = FALSE}
data("atac_tissue_score")

### subsetting only a set of numerical columns
data1 = atac_tissue_score[,8:26]


plot_circle(data1, 
            point_line_colors = rep('black', 19),
            magnituderange = c(1, Inf),
            n = 19, 
            output_table = FALSE, 
            point_size = 3) + 
ggtitle('Pol III transcribed genes \n accessibility across tissues')

```

```{r circ_tiss_filt1, eval = TRUE, echo = TRUE, message = FALSE}
data("atac_tissue_score")


plot_circle(data1, 
            point_line_colors = rep('black', 19),
            entropyrange = c(0,1), 
            magnituderange = c(1, Inf),
            straight_points = FALSE, 
            n = 19, 
            output_table = FALSE, 
            point_size = 3) + 
ggtitle('Pol III transcribed genes \n accessibility across tissues - Unique')
```

```{r circ_tiss_filt2, eval = TRUE, echo = TRUE, message = FALSE}
data("atac_tissue_score")

plot_circle(data1, 
            point_line_colors = rep('black', 19),
            entropyrange = c(4, Inf),
            magnituderange = c(1, Inf),
            n = 19, 
            output_table = FALSE,
            point_size = 3) + 
ggtitle('Pol III transcribed genes \n accessibility across tissues - Shared')
```

## Session Info

```{r session-info, echo=FALSE}
sessionInfo()
```
